<a name="inicio"></a>

# üìò **THE CURE PROJECT** üßë‚ÄçüíªüöÄ

# Servicios complementarios requeridos

Adem√°s de la implementaci√≥n de los servicios b√°sicos de AOD, VOD y base de datos, la empresa InnovateTech nos ha solicitado la implementaci√≥n de cuatro servicios complementarios. 

**EXPLICAR M√ÅS SOBRE LAS RAZONES POR LAS QUE HEMOS ELEGIDO ESTOS SERVICIOS**

---

# Servicio de Chatbot para Soporte T√©cnico y Atenci√≥n al Cliente

## Desarrollo e implementaci√≥n de un bot de soporte automatizado mediante Telegram.

En un entorno profesional de servicios digitales como el de una empresa de streaming de audio y video, el √°rea de soporte t√©cnico desempe√±a un rol clave tanto para la continuidad operativa como para la experiencia del usuario final. Debido a la criticidad de los servicios ofrecidos ‚Äîprincipalmente por su naturaleza 24/7, su dependencia del ancho de banda y su arquitectura distribuida‚Äî, es com√∫n encontrarse con un volumen importante de incidencias repetitivas, las cuales muchas veces pueden ser resueltas mediante respuestas automatizadas. En este contexto, la implementaci√≥n de un bot de mensajer√≠a automatizado, utilizando Telegram como plataforma de mensajer√≠a y Python como lenguaje de programaci√≥n, se convierte en una soluci√≥n viable, escalable y segura para la gesti√≥n inicial de incidencias t√©cnicas.

### Creaci√≥n del bot en Telegram

El proceso comienza con la creaci√≥n del bot en la plataforma de Telegram. Telegram proporciona una interfaz automatizada a trav√©s de un bot interno llamado **@BotFather**, el cual permite registrar nuevos bots mediante comandos. A trav√©s de este canal, el administrador puede definir el nombre del bot, su identificador √∫nico y, lo m√°s importante, obtener el token de autenticaci√≥n que servir√° como clave privada para acceder a la API de Telegram. Este token es sensible, por lo tanto, se recomienda almacenarlo en un fichero externo .env o bien declararlo como variable de entorno en el sistema operativo, evitando as√≠ la exposici√≥n directa en el c√≥digo fuente.

- Abre Telegram y busca el bot oficial @BotFather.
- Escribe el comando /newbot y sigue las instrucciones:
Ingresa un nombre visible para tu bot (por ejemplo: SoporteInnovateTechBot).
Ingresa un nombre de usuario √∫nico que termine en bot (por ejemplo: InnovateSupportBot).
- Una vez creado, @BotFather te enviar√° un token de autenticaci√≥n, necesario para comunicarte con la API de Telegram.

‚ö†Ô∏è Importante: Guarda este token en un archivo .env o como variable de entorno del sistema para evitar su exposici√≥n en el c√≥digo fuente.

### Entorno de desarrollo

Una vez obtenidas las credenciales, se procede con la preparaci√≥n del entorno de desarrollo y ejecuci√≥n. Para este proyecto se eligi√≥ el sistema operativo Ubuntu Server en su versi√≥n LTS m√°s reciente, ya que proporciona un entorno estable, seguro y ampliamente utilizado en entornos de producci√≥n. El lenguaje de programaci√≥n seleccionado fue Python, debido a su madurez, simplicidad y el amplio soporte de librer√≠as tanto para operaciones de red como para el consumo de APIs REST. En concreto, se utiliz√≥ la librer√≠a **python-telegram-bot**, en su versi√≥n as√≠ncrona (v20+), que permite aprovechar mejor los recursos del sistema y manejar m√∫ltiples usuarios concurrentemente sin bloquear procesos.

### Entorno virtual

Antes de escribir el c√≥digo, se debe preparar un entorno virtual utilizando venv. Esto se hace con el objetivo de aislar las dependencias del bot respecto al sistema operativo base, evitando conflictos con otras aplicaciones o versiones de librer√≠as. La activaci√≥n del entorno virtual asegura que cualquier instalaci√≥n de paquetes se realice en un directorio aislado. Dentro de este entorno se procede a instalar la librer√≠a principal del bot, junto con otras dependencias necesarias como aiohttp para posibles integraciones futuras con APIs externas.

- Instala Python y pip si a√∫n no lo tienes:

sudo apt update
 
sudo apt install python3 python3-pip python3-venv

- Crea un entorno virtual para aislar las dependencias del proyecto:

python3 -m venv venv

source venv/bin/activate

- Instala las librer√≠as necesarias:
pip install python-telegram-bot aiohttp python-dotenv

### C√≥digo del bot

En cuanto al dise√±o l√≥gico del bot, este se construye a trav√©s de una serie de funciones que representan distintos estados de conversaci√≥n o flujos de decisi√≥n. Por ejemplo, al recibir el comando /start, el bot responde con un mensaje de bienvenida y presenta un men√∫ de opciones utilizando botones interactivos. Cada bot√≥n est√° vinculado a una funci√≥n espec√≠fica que procesa la elecci√≥n del usuario y lo gu√≠a por una rama distinta del √°rbol de decisiones. Estos flujos est√°n pensados para cubrir las principales incidencias reportadas, como problemas de conexi√≥n, errores en la reproducci√≥n de video o mal funcionamiento del sistema. En cada paso, el bot eval√∫a la entrada del usuario y decide si puede proporcionar una soluci√≥n directamente o si debe derivar la consulta a un t√©cnico humano.

Una de las particularidades de este dise√±o es que toda la interfaz conversacional est√° desarrollada bajo principios UX, utilizando texto claro, iconograf√≠a mediante emojis para facilitar la interpretaci√≥n, y formato enriquecido con Markdown. Adem√°s, el sistema est√° preparado para limitar el uso √∫nicamente a usuarios previamente autorizados, lo que refuerza la seguridad del sistema y evita accesos no deseados.

https://docs.google.com/document/d/1ciAYTOS3JlcPLpn8Etczm83AJyZDRWpCtDJiNXGFcy8/edit?usp=sharing

### Configuraci√≥n del bot como servicio

Para garantizar que el bot funcione de manera persistente y autom√°tica, incluso tras reinicios del sistema o ca√≠das inesperadas, se configura como un servicio gestionado por systemd. Este proceso comienza con la redacci√≥n de un archivo de unidad que describe c√≥mo debe ejecutarse el bot, qu√© usuario del sistema debe hacerlo, cu√°l es su directorio de trabajo, y qu√© acciones tomar en caso de errores. El uso de Restart=always en el fichero de configuraci√≥n garantiza que cualquier fallo en el script desencadenar√° un reinicio autom√°tico del servicio tras unos segundos. Esta estrategia es fundamental para entornos CPD donde la disponibilidad es un requisito cr√≠tico.

La activaci√≥n del servicio se realiza a trav√©s de los comandos de systemd, que permiten registrar el servicio en el arranque del sistema y verificar su estado en tiempo real. Adem√°s, los logs generados por el bot son capturados por journalctl, lo que facilita su monitorizaci√≥n, an√°lisis y trazabilidad ante incidencias.


Crea el archivo de servicio systemd:

sudo nano /etc/systemd/system/telegrambot.service
 Contenido del archivo:

[Unit]
Description=Bot de soporte Telegram
After=network.target

[Service]
User=ubuntu
WorkingDirectory=/home/ubuntu/soporte-bot
ExecStart=/home/ubuntu/soporte-bot/venv/bin/python3 /home/ubuntu/soporte-bot/bot.py
Restart=always

[Install]
WantedBy=multi-user.target

Habilita y lanza el servicio:
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable telegrambot
sudo systemctl start telegrambot

Verifica el estado del bot:
sudo systemctl status telegrambot


Seguridad y administraci√≥n
Desde el punto de vista de la seguridad y la administraci√≥n de sistemas, se han adoptado una serie de pr√°cticas recomendadas. En primer lugar, todo el tr√°fico entre el usuario y el bot est√° cifrado por el protocolo de Telegram, y el bot √∫nicamente responde a comandos definidos, minimizando los vectores de ataque. En segundo lugar, se implementa un control de acceso b√°sico basado en el identificador del usuario, bloqueando cualquier interacci√≥n de actores no autorizados. Por √∫ltimo, se contempla la posibilidad de a√±adir sistemas de alerta autom√°ticos que env√≠en notificaciones al administrador cuando ocurren errores cr√≠ticos, o incluso se podr√≠an establecer integraciones con herramientas como Prometheus o Zabbix para enviar alertas en tiempo real sobre fallos en los sistemas del CPD.

Posibles extensiones
Una vez implementado el sistema b√°sico, el bot puede ser extendido f√°cilmente. Se puede conectar con una base de datos para registrar cada conversaci√≥n y generar estad√≠sticas, se puede dise√±ar una interfaz de administraci√≥n para revisar los historiales, o incluso se puede desplegar en contenedores Docker para facilitar su portabilidad y escalabilidad. Otra mejora futura es el reemplazo del sistema de polling por el uso de webhooks, que permite al bot recibir actualizaciones en tiempo real mediante un servidor HTTPS, eliminando as√≠ la necesidad de consultas constantes a los servidores de Telegram, lo cual mejora el rendimiento y reduce el consumo de recursos.


---

[**‚¨ÜÔ∏è Volver al inicio**](#inicio)
